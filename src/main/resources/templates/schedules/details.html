<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Schedule Details</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f5f5f5; }
        .shadow-soft { box-shadow: 0 10px 30px rgba(15, 23, 42, 0.08); }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
    <div class="container-fluid">
        <a class="navbar-brand" th:href="@{/}">Screens Manager</a>
        <div class="navbar-nav">
            <a class="nav-link" th:href="@{/screens}">Screens</a>
            <a class="nav-link" th:href="@{/ads}">Ads</a>
            <a class="nav-link active" th:href="@{/schedules}">Schedules</a>
        </div>
    </div>
</nav>

<div class="container">
    <!-- Header card -->
    <div class="bg-white rounded-3 shadow-soft p-4 mb-4">
        <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
                <h2 class="mb-2" th:text="${schedule.name}">Schedule name</h2>
                <p class="mb-1">
                    <strong>Date:</strong>
                    <span th:text="${schedule.date}">2024-01-01</span>
                </p>
                <p class="mb-0">
                    <strong>Screen:</strong>
                    <span th:text="${schedule.screen != null ? schedule.screen.screenName : '—'}">
                        Main Screen
                    </span>
                </p>
            </div>
            <div class="text-end">
                <form th:action="@{|/schedules/${schedule.id}/run-once|}" method="post" class="d-inline">
                    <button type="submit" class="btn btn-success mb-2">
                        ▶ Run schedule once (updates stats)
                    </button>
                </form>
                <br>
                <a th:href="@{|/player/schedules/${schedule.id}|}" class="btn btn-outline-primary">
                    Open player
                </a>
            </div>
        </div>
    </div>

    <!-- Items / playlist -->
    <div class="bg-white rounded-3 shadow-soft p-3">
        <h4>Items</h4>
        <table class="table table-striped table-bordered align-middle mb-0">
            <thead>
            <tr>
                <th>#</th>
                <th>Ad title</th>
                <th>Company ID</th>
                <th>Media type</th>
                <th>Duration (s)</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="item : ${schedule.items}">
                <!-- orderNr instead of positionIndex -->
                <td th:text="${item.orderNr}">1</td>

                <!-- ad.title -->
                <td th:text="${item.ad != null ? item.ad.title : '—'}">Ad title</td>

                <!-- ad.companyId -->
                <td th:text="${item.ad != null ? item.ad.companyId : null} ?: '-'">-</td>

                <!-- ad.mimeType -->
                <td th:text="${item.ad != null ? item.ad.mimeType : '—'}">video/mp4</td>

                <!-- duration: we use ad.mediaDuration -->
                <td th:text="${item.ad != null ? item.ad.mediaDuration : 0}">30</td>
            </tr>
            <tr th:if="${#lists.isEmpty(schedule.items)}">
                <td colspan="5" class="text-center text-muted">No items in this schedule.</td>
            </tr>
            </tbody>
        </table>
    </div>

    <a th:href="@{/schedules}" class="btn btn-secondary mt-3">Back to schedules</a>
</div>

</body>
</html>
